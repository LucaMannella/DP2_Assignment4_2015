<?xml version="1.0" encoding="UTF-8"?>

<project name="WF-4 my Ant" default="build-clients&amp;server" basedir=".">
	<description>
		This is an Ant script created by Luca Mannella for WF Assignment 4.
	</description>

	<!-- Properties !-->
	<property name="srcDir" location="${basedir}/src" />
	<property name="buildDir" location="${basedir}/build" />
	<property name="genDir" location="${basedir}/gen-src" />
	<property name="libDir" location="${basedir}/lib" />
	<property name="WSDLpath" location="${basedir}/wsdl/Workflow.wsdl" />

	<property name="package" value="it.polito.dp2.WF.sol4.gen"/>
	<property name="custom.option" value=""/>
	
	<property name="debug" value="true" />
	<property name="debugLevel" value="source,lines,vars" />
	<property name="javaVersion" value="1.7" />
	
	<!-- Init !-->
	<target name="init">
		<echo> Creating folders... </echo>
		<mkdir dir="${buildDir}" />
		<mkdir dir="${genDir}" />
	</target>

	<!-- Clean !-->
	<target name="clean" description="Clean generated files and class files">
		<echo> Deleting folders... </echo>
		<delete dir="${buildDir}" />
		<delete dir="${genDir}" />
	</target>
	
	<!-- Artifacts Generation !-->
	<target name="compile-wsdl" depends="init" description="Compile WSDL and generate bindings">
	    <echo> Wsdl location --> "${WSDLpath}" </echo>
	    <exec executable="wsimport">
	        <arg line="${custom.option} -d '${buildDir}' -p '${package}' -s '${genDir}' -keep ${WSDLpath}"/>
	    </exec>
	</target>

	<!-- Server Building !-->
	<target name="build-server" depends="init, compile-wsdl" >
		<echo> Building the server... </echo>
		<javac destdir="${buildDir}" debug="${debug}" debuglevel="${debugLevel}" source="${javaVersion}" target="${javaVersion}" includeantruntime="false">
			<src path="${srcDir}"/>
			<src path="${genDir}"/>
			<include name="it/polito/dp2/WF/sol4/util/*.java" />
			<include name="it/polito/dp2/WF/sol4/server/*.java" />
			<classpath>
				<path refid="sol.classpath" />
			</classpath>
		</javac>
		<echo>Done.</echo>
	</target>
	
	<!-- Client Building !-->
	<target name="build-client" depends="init, compile-wsdl" >
		<echo> Building the clients... </echo>
		<javac destdir="${buildDir}" debug="${debug}" debuglevel="${debuglevel}" source="${javaVersion}" target="${javaVersion}" includeantruntime="false">
			<src path="${srcDir}"/>
			<src path="${genDir}"/>
			<include name="it/polito/dp2/WF/sol4/client1/*.java" />
			<include name="it/polito/dp2/WF/sol4/client2/*.java" />
			<classpath>
				<path refid="sol.classpath" />
			</classpath>
		</javac>
		<echo>Done.</echo>
	</target>
  
	<!-- The classpath to be used for compilation of the solution -->
	<path id="sol.classpath">
		<pathelement location="${libDir}/WF.jar"/>
	</path>
	
	<!-- Client & Server Building !-->
	<target name="build-clients&amp;server" depends="init, compile-wsdl, build-server, build-client"/>
	
</project>
